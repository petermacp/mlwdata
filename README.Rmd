---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# mlwdata: a repository of datasets for MLW population health in Malawi

<!-- badges: start -->
<!-- badges: end -->

mlwdata contains a set of annotated datasets that have been collected as part of research studies conducted at the Malawi-Liverpool-Wellcome Trust Clinical Research Programme in Blantyre, Malawi.

The main aims are to:

 - ensure consistent use of data between and within studies over time
 - facilitate sharing of data to reduce duplication of efforts

## Installation

You can install the from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("petermacp/mlwdata")
```

<br>

## Datasets

Currently, the following datasets are available:

**scale_72_clusters**
<br>
A `sf` MULTIPOLYGON object, containing polygon boundaries and cluster IDs for the SCALE Study (Corbett et al), with variables:

 - `cluster`: unique identifier for each of the 72 study clusters
 - `geometery`: a list column, containing polygons for each cluster boundary.
 
<br>
 
**blantyre_clinics**
<br>
A `sf` POINT object, containing coordinates for Blantyre clinics/hospitals, and clinic IDs:

 - `clinic`: unique name of each of the 18 clinics/hospitals
 - `geometry`: a list column, containing points for each clinic/hospital.

<br>

**blantyre_census_blantyre_census_2008_2018**
<br>
A `tibble`, containing age, sex and district-stratfied (Blantyre City, Blantyre Rural) population estimates from the 2008 and 2018 Malawi National Census. These data were provided by the Malwai National Statistics Office in October 2019.

 - `District`: either Blantyre City, or Blantyre Rural (as classified in the Census)
 - `Year`: census year (2008 or 2018)
 - `Age`: age group of population estimates
 - `Total`: total population
 - `Male`: Male population
 - `Female`: Female population
 
<br>

**blantyre_tb_cases_2009_2018**
<br>
A `tibble`, containing numbers of TB cases notified in Blantyre TB registration centres between Q1 2009 and Q4 2018 by quarter, and stratified by active case finding area of the city (acf vs. non-acf), and microbiological status of cases

 - `year_q`: Annual quarter
 - `acf`: Area of Blantyre City (ACF = received active case finding intervention; non-ACF = didn't receive active case finding intervention)
 - `tbcases`: Classification of TB diagnosis (`Smr/Xpert-positive` cases = cases that were either smear or xpert positive in testing by the routine clinic programme, or smear-positive by the research TB lab; `All cases` = all cases started on treatment, regardless of microbiological status)
 - `n`: number of cases in category
 
<br>

## Examples

The SCALE Study defined 72 geographical cluster boundaries in urban Blantyre using GPS waypaths. These clusters can be loaded and plotted:

```{r example, message=FALSE, warning=FALSE, fig.width=11, fig.height=11}
library(mlwdata)
library(tidyverse)

glimpse(scale_72_clusters)


ggplot(scale_72_clusters) +
  geom_sf() +
  geom_sf_text(aes(label=cluster), colour="blue") +
  theme_minimal() +
  labs(title="SCALE Study",
       subtitle="72 clusters",
       x="",
       y="",
       caption = "Corbett, MacPherson et al.")
  
```

We could add on the location of the clinics in Blantyre.

```{r example2, message=FALSE, warning=FALSE, fig.width=11, fig.height=18}

library(sf)
library(ggrepel)

qech <- blantyre_clinics %>%
  #filter to show QECH only for interest
  filter(clinic=="Queen Elizabeth hospital") %>%
  #split out the x and y coordinates to allow use of ggrepel
  st_coordinates() %>%
  as_tibble() %>%
  mutate(clinic="QECH")

ggplot() +
  geom_sf(data = scale_72_clusters) +
  geom_sf_text(data = scale_72_clusters, aes(label=cluster), colour="blue") +
  geom_sf(data=blantyre_clinics, shape=17, colour="#22211d") +
  geom_label_repel(data = qech, 
                       aes(x=X, y=Y, label=clinic), 
        fontface = "bold",
        min.segment.length = 0) +
  theme_minimal() +
  labs(title="SCALE Study",
       subtitle="72 clusters. Clinics/hospitals labelled with triangles",
       x="",
       y="",
       caption = "Corbett, MacPherson et al.") +
  coord_sf()


```

